---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import { HomepageSections } from '../components/HomepageSections';

const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.date.valueOf() - a.data.date.valueOf()
).slice(0, 3);

const allResources = await getCollection('resources');
const quickAccessResources = allResources
  .filter(res => res.data['quick-access'] === 'yes')
  .slice(0, 4);

// Fetch latest xkcd comic
let xkcdComic = null;
try {
  const response = await fetch('https://xkcd.com/info.0.json');
  if (response.ok) {
    xkcdComic = await response.json();
  }
} catch (error) {
  console.error('Failed to fetch xkcd comic:', error);
}
---

<Layout title="Terminal Scope">
  <HomepageSections 
    client:load
    posts={posts.map(post => ({
      id: post.id,
      data: {
        title: post.data.title,
        date: post.data.date,
        category: post.data.category,
        excerpt: post.data.excerpt,
      }
    }))}
    quickAccessResources={quickAccessResources.map(res => ({
      id: res.id,
      data: {
        title: res.data.title,
        type: res.data.type,
      }
    }))}
    xkcdComic={xkcdComic}
  />
</Layout>
